<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 
    <head>
        <title>Weather Widget</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    
        <script type="text/javascript" src="/common/core/mootools.js"></script>
        <script type="text/javascript" src="/common/core/cream.js"></script>

        <link rel="stylesheet" type="text/css" href="/common/ui/melange.css" media="screen">
    </head>
 
    <body>
        <div class="widget" style="min-width: 180px;">
            <div class="background">
                <div style="width: 70px; float: left; text-align: center;">
                    <img id="icon" src="images/clear.png" onmousedown="return false;" /><br />
                    <span id="temperature" style="font-size: 1.8em; font-weight: bold; line-height: 1em;">N/A</span>
                </div>
                <div style="margin-left: 80px;">
                    <span style="font-size: .65em; line-height: 1em;">Wind:</span><br />
                    <span id="wind" style="font-size: .8em; font-weight: bold; line-height: 1em;">N/A</span><br />
    
                    <span style="font-size: .65em; line-height: 1em;">Humidity:</span><br />
                    <span id="humidity" style="font-size: .8em; font-weight: bold; line-height: 1em;">N/A</span><br />
    
                    <span style="font-size: .65em; line-height: 1em;">Pressure:</span><br />
                    <span id="pressure" style="font-size: .8em; font-weight: bold; line-height: 1em;">N/A</span>
                </div>
                <div style="clear: both;"></div>

                <div style="position: absolute; top: 50px; left: 50px;" id="throbber">
                </div>

                <script type="text/javascript">
                    throbber_state = 0;
                    function main() {
                        var icons = {
                            'clear': 'clear.png',
                            'cloudy': 'cloudy.png',
                            'flurries': 'flurries.png',
                            'fog': 'fog.png',
                            'hazy': 'hazy.png',
                            'mostlycloudy': 'mostlycloudy.png',
                            'mostlysunny': 'mostlysunny.png',
                            'partlycloudy': 'partlycloudy.png',
                            'partlysunny': 'partlysunny.png',
                            'rain': 'rain.png',
                            'sleet': 'sleet.png',
                            'snow': 'snow.png',
                            'sunny': 'sunny.png',
                            'tstorms': 'thunderstorms.png',
                            'unknown': 'unknown.png',
                        };
                        
                        function update_weather() {
                            widget.api.weather.get(widget.config.get('location'), function(data) {
                                $('temperature').set('text', data['temperature'] + 'Â°C');
                                $('wind').set('text', data['wind_speed'] + 'km/h');
                                $('humidity').set('text', data['humidity'] + '%');
                                $('pressure').set('text', data['pressure'] + 'hPa');
                                $('icon').set('src', 'images/' + icons[data['icon']]);                        
                            });
                        }


                        var configuration_update_timeout_id;
                        widget.config.addEvent('field-value-changed', function(sender, field, new_value) {
                            /* This function is called every time the user types something in the
                               configuration dialog input box. To avoid lots of requests to the weather
                               service, ensure that at least 3 seconds have passed before the next
                               request is send by using a timeout.
                            */
                            $clear(configuration_update_timeout_id);
                            configuration_update_timeout_id = update_weather.delay(3000);
                        });


                        update_weather.delay(50);
                        update_weather.periodical(60000);
                    }
                </script>
            </div>
        </div>
    </body>
 
</html>
